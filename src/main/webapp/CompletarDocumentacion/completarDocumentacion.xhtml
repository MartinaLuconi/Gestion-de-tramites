<ui:composition xmlns="http://www.w3.org/1999/xhtml"  
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                xmlns:adm="http://github.com/adminfaces"
                template="#{layoutMB.template}">

<ui:define name="metadata">
        <h:outputStylesheet name="css/completarDoc.css" />
</ui:define>

    <ui:define name="body" >
        <h:form enctype="multipart/form-data" >
            <p:focus context="@form"/>
            <h:messages id="messages" showDetail="true" globalOnly="true" />

            <div class="box box-primary">
                <h1 style="font-size: 48px; font-weight: bold; color: #333; padding-left: 20px;">Completar Documentación</h1>
                <p:separator/>

                

                <h:panelGroup id="container">
                    <h:panelGrid id="detalleTramite" columns="1" rendered="#{not empty uicompletarDocumentacion.dtoCompletarDoc}">
                        <h:outputText value="Datos del Trámite:" styleClass="section-title" />

                        <table class="dataTable">
                            <tr>
                                <th>Número de Trámite</th>
                                <td>#{uicompletarDocumentacion.dtoCompletarDoc.nroTramite}</td>
                            </tr>
                            <tr>
                                <th>Cliente</th>
                                <td>#{uicompletarDocumentacion.dtoCompletarDoc.nombreApellidoCliente}</td>
                            </tr>
                            <tr>
                                <th>CUIT</th>
                                <td>#{uicompletarDocumentacion.dtoCompletarDoc.cuitCliente}</td>
                            </tr>
                            <tr>
                                <th>Tipo de Trámite</th>
                                <td>#{uicompletarDocumentacion.dtoCompletarDoc.nombreTipoTramite}</td>
                            </tr>
                            <tr>
                                <th>Fecha de Vencimiento</th>
                                <td>#{uicompletarDocumentacion.dtoCompletarDoc.fechaVencimientoDocumentacion}</td>
                            </tr>
                            <tr>
                                <th>Fecha de Fin de Entrega</th>
                                <td>#{uicompletarDocumentacion.dtoCompletarDoc.fechaHoraFinEntregaDoc} </td>
                            </tr>
                        </table>
                    </h:panelGrid>

                    <p:dataTable id="grid1" widgetVar="docuTable" 
                                 value="#{uicompletarDocumentacion.documentos}" var="doc"
                                 styleClass="completarDocumentacion-table">
                        <p:column headerText="Nombre Documentación">
                            #{doc.nombreDocumentacion}
                        </p:column>
                        
                        <p:column headerText="Código">
                            #{doc.codTramiteDocumentacion}
                        </p:column>
                        
                        <p:column headerText="Fecha de Entrega">
                            <h:outputText value="#{doc.fechaHoraEntrega}">
                                <f:convertDateTime pattern="dd/MM/yyyy HH:mm" />
                            </h:outputText>
                        </p:column>
                        
                        <p:column>
                            <!-- Componente de carga de archivos -->
                            <p:fileUpload id="fileUpload" listener="#{uicompletarDocumentacion.handleFileUpload}"
                                          label="Adjuntar" dragDropSupport="false" auto="true" 
                                          onstart="showBar()" oncomplete="hideBar()" 
                                          mode="advanced" multiple="false" 
                                          update="messages fileInfo" sizeLimit="100000000" />

                            <!-- Mensaje de feedback para el archivo subido -->
                            <h:outputText id="fileInfo" 
                                          styleClass="file-info-message" />

                            <!-- Mensajes de éxito o error en la carga del archivo -->
                            <p:messages id="messages" showDetail="true" closable="true" />

                            <!-- Botones para guardar o cancelar -->
                            <p:commandButton value="Guardar" 
                                             action="#{uicompletarDocumentacion.guardarArchivo(uicompletarDocumentacion.nroTramite, doc.codTramiteDocumentacion)}" 
                                             update="messages fileInfo" 
                                             oncomplete="PF('fileUploadWidgetVar').reset()"/>

                            <p:commandButton value="Cancelar" 
                                             action="#{uicompletarDocumentacion.cancelar}"            
                                             update="messages fileInfo" 
                                             oncomplete="PF('fileUploadWidgetVar').reset()" />
                            
                            <p:commandButton icon="pi pi-download" title="Descargar"
                                             action="#{uicompletarDocumentacion.descargarArchivo(uicompletarDocumentacion.nroTramite, doc.codTramiteDocumentacion)}"
                                             disabled="#{doc.fechaHoraEntrega == null}"
                                             ajax="false" styleClass="small-add-button">
                            </p:commandButton>
                            
                            <p:commandButton icon="pi pi-times" title="Eliminar"
                                             action="#{uicompletarDocumentacion.eliminarArchivo(uicompletarDocumentacion.nroTramiteExtends, doc.codTramiteDocumentacion)}"
                                             disabled="#{doc.fechaHoraEntrega == null}"
                                             styleClass="custom-remove-button"
                                             update="messages, grid1" ajax="true" />


                        </p:column>
                        
                    </p:dataTable>
                </h:panelGroup>
            </div>
        </h:form>
    </ui:define>
</ui:composition>
